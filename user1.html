<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
      integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
      crossorigin=""
    />
  </head>

  <body>
    2
    <div id="map" style="width: 600px; height: 400px"></div>

    <script
      src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
      integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
      crossorigin=""
    ></script>

    <script>
        var lat;
        var lng;
        var lat2;
        var lng2;
        let distance
        function createMap() {
          var map = L.map("map");
          L.tileLayer(
            "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",
            {
              attribution:
                'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
              maxZoom: 18,
              id: "mapbox/streets-v11",
              tileSize: 512,
              zoomOffset: -1,
              accessToken:
                "pk.eyJ1IjoiamFja3NvbmphY2tzb25qYWNrc29uIiwiYSI6ImNsMHQ3MHBuOTBodzczY3JwOW91NTk5djEifQ.hfwu_tJVcukZMyLU-IcvbA",
            }
          ).addTo(map);
          navigator.geolocation.getCurrentPosition((position) => {
            const {
              coords: { latitude, longitude },
            } = position;

            map.setView([latitude, longitude], 13).locate();
          });
          navigator.geolocation.getCurrentPosition((position) => {
            const {
              coords: { latitude, longitude },
            } = position;
            var marker = new L.marker([latitude, longitude], {
              draggable: true,
              autoPan: true,
            }).addTo(map);

            console.log(marker);
          });
        }

        // createMap(coords);
        function calculateDistance() {
          lng =  lng * Math.PI / 180;
          lng2 = lng2 * Math.PI / 180;
          lat = lat * Math.PI / 180;
          lat2 = lat2 * Math.PI / 180;

          // Haversine formula
          let dlon = lon2 - lon1;
          let dlat = lat2 - lat;
          let a = Math.pow(Math.sin(dlat / 2), 2)
                   + Math.cos(lat) * Math.cos(lat2)
                   * Math.pow(Math.sin(dlon / 2),2);

          let c = 2 * Math.asin(Math.sqrt(a));

          // Radius of earth in kilometers. Use 3956
          // for miles
          let r = 6371;

          // calculate the result
          return(c * r);
      }
          if (navigator.geolocation)
            navigator.geolocation.getCurrentPosition(
              function (position) {
                console.log(position.coords.longitude);

                document.getElementById("demo").innerHTML =
                  "X=" +
                  position.coords.latitude +
                  ", Y=" +
                  position.coords.longitude;

                lat = position.coords.latitude;
                lng = position.coords.longitude;
                return lat;
              },
              function () {
                alert("Could not get it");
              }
            );

          setTimeout(calculateDistance, 5000);
        }

        createMap(calculateDistance());
    </script>
  </body>
</html>
